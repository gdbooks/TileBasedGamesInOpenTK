
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Open The Door Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.1">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="cleanup.html" />
    
    
    <link rel="prev" href="Chapter10.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Chapter1.html">
            
                <a href="Chapter1.html">
            
                    
                    Starting Out
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="FrameworksSources.html">
            
                <a href="FrameworksSources.html">
            
                    
                    Managers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="Game.html">
            
                <a href="Game.html">
            
                    
                    Game
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="Program.html">
            
                <a href="Program.html">
            
                    
                    Program
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Chapter2.html">
            
                <a href="Chapter2.html">
            
                    
                    Why Tiles?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Chapter3.html">
            
                <a href="Chapter3.html">
            
                    
                    Map Format
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Chapter6.html">
            
                <a href="Chapter6.html">
            
                    
                    Creating Tiles
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="Practice/PracticeCh6.html">
            
                <a href="Practice/PracticeCh6.html">
            
                    
                    On Your Own
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Chapter5.html">
            
                <a href="Chapter5.html">
            
                    
                    Map Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="Chapter8.html">
            
                <a href="Chapter8.html">
            
                    
                    The Hero
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="Practice/PracticeTheHero.html">
            
                <a href="Practice/PracticeTheHero.html">
            
                    
                    On Your Own
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="Chapter9.html">
            
                <a href="Chapter9.html">
            
                    
                    Keys To Move
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="Practice/PracticeMoving.html">
            
                <a href="Practice/PracticeMoving.html">
            
                    
                    On Your Own
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="Chapter10.html">
            
                <a href="Chapter10.html">
            
                    
                    Hit The Wall
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.10" data-path="Chapter11.html">
            
                <a href="Chapter11.html">
            
                    
                    Open The Door
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="cleanup.html">
            
                <a href="cleanup.html">
            
                    
                    Cleaning Up
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="borders.html">
            
                <a href="borders.html">
            
                    
                    Screen Borders
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="Chapter12.html">
            
                <a href="Chapter12.html">
            
                    
                    Jumping
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="jumpconfig.html">
            
                <a href="jumpconfig.html">
            
                    
                    Configurable Jumping
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="Chapter13.html">
            
                <a href="Chapter13.html">
            
                    
                    Clouds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="Chapter15.html">
            
                <a href="Chapter15.html">
            
                    
                    Simple Enemy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="Chapter17.html">
            
                <a href="Chapter17.html">
            
                    
                    Shooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="Chapter18.html">
            
                <a href="Chapter18.html">
            
                    
                    Getting Items
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="Chapter20.html">
            
                <a href="Chapter20.html">
            
                    
                    Scrolling
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="Chapter21.html">
            
                <a href="Chapter21.html">
            
                    
                    Limit Scrolling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="Chapter22.html">
            
                <a href="Chapter22.html">
            
                    
                    Depth
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="SpeerateCollisionAndRendering.html">
            
                <a href="SpeerateCollisionAndRendering.html">
            
                    
                    Collision & Rendering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="AddingAHouse.html">
            
                <a href="AddingAHouse.html">
            
                    
                    Visual Tweaks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="DepthBuffer.html">
            
                <a href="DepthBuffer.html">
            
                    
                    Depth Buffer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="Chapter23.html">
            
                <a href="Chapter23.html">
            
                    
                    Ismetric View
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="Iso_MakeMap.html">
            
                <a href="Iso_MakeMap.html">
            
                    
                    Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="Iso_MakeCharacters.html">
            
                <a href="Iso_MakeCharacters.html">
            
                    
                    Characters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3" data-path="Iso_MakeItems.html">
            
                <a href="Iso_MakeItems.html">
            
                    
                    Items & Projectiles
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="Chapter24.html">
            
                <a href="Chapter24.html">
            
                    
                    Mouse To Move
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="Chapter7.html">
            
                <a href="Chapter7.html">
            
                    
                    More Tiles
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Open The Door</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="open-the-door">Open The Door</h1>
<p>In the last chapter we explored how to add collision to the walls of our room. This is aweome! But Link is feeling claustrophobic! He is an epic hero, confined to a tiny room... In this chapter we are going to double the size of Link&apos;s world by adding a second room to it! Here is the layout of what this is going to look like:</p>
<p><img src="Images/multiroom.png" alt="ROOMS"></p>
<p>Of course only one of these rooms is going to be visible at a time, link&apos;s going to have to go trough the green door to visit the adjacent room. </p>
<p>The nice thing here, none of the code for this is going to have to go inside the <code>PlayerCharacter</code> class, as none of this is specific to the player. Instead we&apos;re going to be writing most of our code inside of <strong>Game.cs</strong></p>
<h3 id="new-project">New Project</h3>
<p>Let&apos;s make a new project, call it <strong>OpenTheDoor</strong> and get this project up to par with the <strong>HitTheWall</strong> section of the writeup. We&apos;re going to work from here.</p>
<h3 id="the-door-tile">The door tile</h3>
<p>First thing is first, let&apos;s add our door tile that will lead into the second room. We&apos;re going to be working in <strong>Game.cs</strong>. Right now we define the map layout in the <code>mapLayout</code> variable where tile 1 is a wall and tile 0 is walkable. Let&apos;s add tile 2, which will be the door. </p>
<ul>
<li>In the <code>mapLayout</code> varibale, change the appropriate tile to be a door<ul>
<li>Look at the above screnshot, it&apos;s the tile in the lower right</li>
</ul>
</li>
<li>Add <code>new Rectangle(32, 187, 30, 30)</code> to the <code>spriteSources</code> array</li>
<li>Make tile 2 walkable. So tiles 0 and 2 should both be walkable.</li>
</ul>
<p>Be careful when walking around! While you should be able to walk a little bit into the door, if you walk too far into the new door tile the game will crash. This is expected. After the above changes, running the game should look like this:</p>
<p><img src="Images/door1.PNG" alt="DOOR1"></p>
<h3 id="the-second-room">The second room</h3>
<p>Sweet we now have a door (well, visually at least), but it doesn&apos;t lead anywhere! We&apos;re going to add a second map. Still in <strong>Game.cs</strong>, refactor the name of the <code>map</code> variable to be <code>room1</code>. To do this, right click on <code>map</code> and select <strong>Rename</strong></p>
<p><img src="Images/rename_map.png" alt="RENAME"></p>
<p>This will cause the <code>map</code> variable to highlight in some strange green color, just start typing and the name of the variable will change. When you are done, hit enter and all instances of <code>map</code> will be autmatically renamed for you.</p>
<p><img src="Images/green_map.PNG" alt="GREEN"></p>
<p>Now rename the <code>mapLayout</code> variable to be named <code>room1Layout</code>. </p>
<p><strong>Run The Game</strong> at this point it&apos;s important for you to run the game and make sure it still works correctly!</p>
<p>Next, let&apos;s add the definition of <code>room2</code> and <code>room2Layout</code>. Seeing how this is mostly a copy / paste job of <code>room1</code> with minor alterations, use this clode:</p>
<pre><code>protected Tile[][] room2 = null;

protected int[][] room2Layout = new int[][] {
    new int[] { 1, 1, 1, 1, 1, 1, 1, 1 },
    new int[] { 2, 0, 0, 0, 1, 0, 0, 1 },
    new int[] { 1, 0, 0, 0, 0, 0, 0, 1 },
    new int[] { 1, 0, 0, 0, 0, 0, 0, 1 },
    new int[] { 1, 0, 0, 0, 1, 0, 0, 1 },
    new int[] { 1, 1, 1, 1, 1, 1, 1, 1 }
};
</code></pre><p>Inside of the <strong>Initialize</strong> function, make sure that <code>room2</code> is created! Also, inside <strong>Destroy</strong> make sure that <code>room2</code> is unloaded.</p>
<h3 id="the-current-room">The current room</h3>
<p>At this point we have two rooms, but they are kind of useless. This is because every function is hard-coded to work with room1. Let&apos;s fix that by introducing a <code>currentRoom</code> variable! Start off by adding these two member variables:</p>
<pre><code>protected Tile[][] currentRoom = null;
protected int[][] currentLayout = null;
</code></pre><p>At the end of the initialize function point the <code>currentRoom</code> and <code>currentLayout</code> references at room2, like so:</p>
<pre><code>currentRoom = room2;
currentLayout = room2Layout;
</code></pre><p>Of course running the game, link still starts out in <code>room1</code>. this is because nothing is using the <code>currentRoom</code> variable yet. Update the following to use <code>currentRoom</code> instead of <code>room1</code>:</p>
<ul>
<li>GetTile function</li>
<li>Render function</li>
</ul>
<p><strong>Running the game</strong>, link should now be in room2. Make sure the collisions are correct.</p>
<h3 id="walking-trough-the-door">Walking trough the door</h3>
<p>The last thing left to do is to add the logic to walk link trough that door. And this is going to be pretty simple. In the <code>Update</code> method of <strong>Game.cs</strong>, we&apos;re going to check if the player rectangle intersects with any door rectangles. If it does, based on the door number we will set currentRoom to the appropriate room. Finally, we will set the position of the player to look like he&apos;s walked trough the door.</p>
<p>One thing you might have noticed about the above logic, if we transport the player as soon as he touches the door, it might not look natural. It definateley won&apos;t look like link is walking trough the door... More like he accidentally touched a magic portal. Because of this, instead of checking links bounding box, we&apos;re going to construct a 4PX rectangle at his center. And we will test this against intersecting with the door.</p>
<p>I originally wanted to make this an &quot;On Your Own&quot; exercise, but the code is pretty straight forward, and it&apos;s hard to give instructions on it. So, read the below code carefully, and let me know if you have any questions.</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> dt</span>) </span>{
    <span class="hljs-comment">// Let the hero move, and sort out any collision issues</span>
    hero.Update(dt);
    <span class="hljs-comment">// We need to check for doors AFTER the player has moved</span>

    <span class="hljs-comment">// Loop torugh the layout, the Tile class does not know if it is a door or not.</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; currentLayout.Length; ++row) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> col = <span class="hljs-number">0</span>; col &lt; currentLayout[row].Length; ++col) {
            <span class="hljs-comment">// The tile is a door if it had a 2 in the layout!</span>
            <span class="hljs-keyword">if</span> (currentLayout[row][col] == <span class="hljs-number">2</span>) {
                <span class="hljs-comment">// Get the door&apos;s bounding rectangle</span>
                Rectangle doorRect = GetTileRect(<span class="hljs-keyword">new</span> PointF(col * <span class="hljs-number">30</span>, row * <span class="hljs-number">30</span>));

                <span class="hljs-comment">// Get a small rectangle in the center of the player</span>
                Rectangle playerCenter = <span class="hljs-keyword">new</span> Rectangle((<span class="hljs-keyword">int</span>)hero.Center.X - <span class="hljs-number">2</span>, (<span class="hljs-keyword">int</span>)hero.Center.Y - <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>);

                <span class="hljs-comment">// Look for an intersection</span>
                Rectangle intersection = Intersection.Rect(doorRect, playerCenter);

                <span class="hljs-comment">// Intersection happens if the intersect rectangle has an area &gt; 0</span>
                <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-comment">// If we are in room1, move to room 2</span>
                    <span class="hljs-keyword">if</span> (currentRoom == room1) {
                        <span class="hljs-comment">// Set active room</span>
                        currentRoom = room2;
                        currentLayout = room2Layout;

                        <span class="hljs-comment">// Reposition hero to tile outside of door</span>
                        hero.Position.X = <span class="hljs-number">1</span> * <span class="hljs-number">30</span>; <span class="hljs-comment">// Column 1</span>
                        hero.Position.Y = <span class="hljs-number">1</span> * <span class="hljs-number">30</span>; <span class="hljs-comment">// Row 1</span>
                    }
                    <span class="hljs-comment">// If we are in room 2, move to room 1</span>
                    <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// Set active room</span>
                        currentRoom = room1;
                        currentLayout = room1Layout;

                        <span class="hljs-comment">// Reposition hero to tile outside of door</span>
                        hero.Position.X = <span class="hljs-number">6</span> * <span class="hljs-number">30</span>; <span class="hljs-comment">// Column 6</span>
                        hero.Position.Y = <span class="hljs-number">4</span> * <span class="hljs-number">30</span>; <span class="hljs-comment">// Row 4</span>
                    }
                }
            }
        }
    }
}
</code></pre>
<p><strong>Run the game</strong>, you should now be able to walk from room to room!</p>
<p>You might be thinking to yourself, we could make things easyer by storing a bolean in the <code>Tile</code> class, then we wouldn&apos;t need to loop trough the tileLayout array.... And you are correct! In fact, that&apos;s what the next section is all about. Read on!</p>
<h1 id="cleaning-up">Cleaning Up</h1>
<p>Follow along to the code in the <strong>Cleaning</strong> Up subsection inside of this (OpenTheDoor) project. The <strong>Cleaning Up</strong> section just gives us an easy way to store room&apos;s as objects, instead of cluttering up the <strong>Game.cs</strong> file.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Chapter10.html" class="navigation navigation-prev " aria-label="Previous page: Hit The Wall">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="cleanup.html" class="navigation navigation-next " aria-label="Next page: Cleaning Up">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Open The Door","level":"1.10","depth":1,"next":{"title":"Cleaning Up","level":"1.10.1","depth":2,"path":"cleanup.md","ref":"cleanup.md","articles":[]},"previous":{"title":"Hit The Wall","level":"1.9","depth":1,"path":"Chapter10.md","ref":"Chapter10.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"letter","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Chapter11.md","mtime":"2016-07-09T03:24:55.781Z","type":"markdown"},"gitbook":{"version":"3.1.1","time":"2016-10-03T18:07:37.300Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

