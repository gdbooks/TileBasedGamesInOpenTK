
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Mouse To Move Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.1">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Chapter7.html" />
    
    
    <link rel="prev" href="Iso_MakeItems.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Chapter1.html">
            
                <a href="Chapter1.html">
            
                    
                    Starting Out
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="FrameworksSources.html">
            
                <a href="FrameworksSources.html">
            
                    
                    Managers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="Game.html">
            
                <a href="Game.html">
            
                    
                    Game
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="Program.html">
            
                <a href="Program.html">
            
                    
                    Program
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Chapter2.html">
            
                <a href="Chapter2.html">
            
                    
                    Why Tiles?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Chapter3.html">
            
                <a href="Chapter3.html">
            
                    
                    Map Format
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Chapter6.html">
            
                <a href="Chapter6.html">
            
                    
                    Creating Tiles
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="Practice/PracticeCh6.html">
            
                <a href="Practice/PracticeCh6.html">
            
                    
                    On Your Own
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Chapter5.html">
            
                <a href="Chapter5.html">
            
                    
                    Map Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="Chapter8.html">
            
                <a href="Chapter8.html">
            
                    
                    The Hero
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="Practice/PracticeTheHero.html">
            
                <a href="Practice/PracticeTheHero.html">
            
                    
                    On Your Own
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="Chapter9.html">
            
                <a href="Chapter9.html">
            
                    
                    Keys To Move
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="Practice/PracticeMoving.html">
            
                <a href="Practice/PracticeMoving.html">
            
                    
                    On Your Own
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="Chapter10.html">
            
                <a href="Chapter10.html">
            
                    
                    Hit The Wall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="Chapter11.html">
            
                <a href="Chapter11.html">
            
                    
                    Open The Door
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="cleanup.html">
            
                <a href="cleanup.html">
            
                    
                    Cleaning Up
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="borders.html">
            
                <a href="borders.html">
            
                    
                    Screen Borders
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="Chapter12.html">
            
                <a href="Chapter12.html">
            
                    
                    Jumping
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="jumpconfig.html">
            
                <a href="jumpconfig.html">
            
                    
                    Configurable Jumping
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="Chapter13.html">
            
                <a href="Chapter13.html">
            
                    
                    Clouds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="Chapter15.html">
            
                <a href="Chapter15.html">
            
                    
                    Simple Enemy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="Chapter17.html">
            
                <a href="Chapter17.html">
            
                    
                    Shooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="Chapter18.html">
            
                <a href="Chapter18.html">
            
                    
                    Getting Items
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="Chapter20.html">
            
                <a href="Chapter20.html">
            
                    
                    Scrolling
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="Chapter21.html">
            
                <a href="Chapter21.html">
            
                    
                    Limit Scrolling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="Chapter22.html">
            
                <a href="Chapter22.html">
            
                    
                    Depth
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="SpeerateCollisionAndRendering.html">
            
                <a href="SpeerateCollisionAndRendering.html">
            
                    
                    Collision & Rendering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="AddingAHouse.html">
            
                <a href="AddingAHouse.html">
            
                    
                    Visual Tweaks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="DepthBuffer.html">
            
                <a href="DepthBuffer.html">
            
                    
                    Depth Buffer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="Chapter23.html">
            
                <a href="Chapter23.html">
            
                    
                    Ismetric View
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="Iso_MakeMap.html">
            
                <a href="Iso_MakeMap.html">
            
                    
                    Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="Iso_MakeCharacters.html">
            
                <a href="Iso_MakeCharacters.html">
            
                    
                    Characters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3" data-path="Iso_MakeItems.html">
            
                <a href="Iso_MakeItems.html">
            
                    
                    Items & Projectiles
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.19" data-path="Chapter24.html">
            
                <a href="Chapter24.html">
            
                    
                    Mouse To Move
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="Chapter7.html">
            
                <a href="Chapter7.html">
            
                    
                    More Tiles
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Mouse To Move</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="mouse-to-move">Mouse To Move</h1>
<p>Using the mouse to move will involve some rudimentary pathfinding / AI. We&apos;re going to implement the simplest path-finding possible. Usually, when doing a mouse to move you would use the A* algorithm to find the shortest path, however i have that lesson planned for later.</p>
<h3 id="new-project">New Project</h3>
<p>Let&apos;s make a new project, call it <strong>MouseToMove</strong> and get this project up to par with the <strong>OpenTheDoor</strong> section of the writeup. We&apos;re going to work from here.</p>
<p>We don&apos;t care about items, enemies or bullets. We just want to be able to walk around with a mouse. And i&apos;m hoping this means typing a little less boiler plate code.</p>
<h3 id="tile-size">Tile Size</h3>
<p>We are starting off from a state before we did the tile size refactor in the isometric section (obviously), but i don&apos;t like having 30 all over the place. I made a new <code>public static readonly</code> variable in <strong>Game.cs</strong> called <code>TILE_SIZE</code> and refactored the rest of the project to use this instead of the hard coded 30</p>
<p>You can keep hard coding 30, or do this refactor too, it&apos;s up to you. For the remainder of this article i&apos;m going to be refering to the size of the tile by this new constant in <strong>Game.cs</strong></p>
<h3 id="mouse-indicator">Mouse Indicator</h3>
<p>Clicking on tiles is usually obvious enough, but having a mouse indicator is always a nice touch. We&apos;re going to figure out which tile the mouse is over and highlight it with a red outline.</p>
<p>In <strong>Game.cs</strong>, make a new <code>Point</code> variable, call it <code>cursorTile</code>. In Update, we&apos;re going to set this. Set it to the tile that the mouse is on. Because our tiles are based on a grid of 30, if a mouse is at 45,67 it&apos;s tile would be 2,3.</p>
<p>In the render function, go ahead and draw a red rectangle around the selected tile. Remember to bring the tile from &quot;tile space&quot; back into &quot;world space&quot;. We don&apos;t have a method to draw a square outline, you will have to do it with 4 lines. Here is what this should look like:</p>
<p><img src="Images/tile_select.png" alt="SELECT"></p>
<p><strong>Note:</strong> Right now you probably just divided the mouse position X and Y by tile size, that should work very well for this demo. Be aware however, if you add scrolling, you will have to account for the scrolling offset in the mouse position!</p>
<h3 id="target-location">Target location</h3>
<p>Inside <strong>PlayerCharacter.cs</strong> make a new variable:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">protected</span> Point targetTile = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre>
<p>This variable represents the tile we want to walk to (in tile space). Publicly, we don&apos;t need any way to see the value of the variable, but we do need a way to set it. Let&apos;s add a setter function:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetTargetTile</span>(<span class="hljs-params">Point target</span>) </span>{
    targetTile = <span class="hljs-keyword">new</span> Point(target.X, target.Y);
}
</code></pre>
<p>Next, in the <code>Update</code> method, after getting a local input manager instance, find the tile that the player is currently in:</p>
<pre><code class="lang-cs">Point currentTile = <span class="hljs-keyword">new</span> Point((<span class="hljs-keyword">int</span>)(Position.X) / Game.TILE_SIZE, (<span class="hljs-keyword">int</span>)Position.Y / Game.TILE_SIZE);
</code></pre>
<h3 id="broad-phase-movement">Broad phase movement</h3>
<p>At this point we know the current tile of the player and the target tile of the player. We also have code to move the player on screen with the keyboard. What we need to do is to change the movement conditions.</p>
<p>Instead of looking at the keyboard, the movement conditions should look at the current and target tiles of the player.For example, if player tile is 5, but target tile is 2 the player should just move left!</p>
<p>Change this line:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (i.KeyDown(OpenTK.Input.Key.A) || i.KeyDown(OpenTK.Input.Key.Left)) {
</code></pre>
<p>to this:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (targetTile.X &lt; currentTile.X) {
</code></pre>
<p>And this line</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> (<span class="hljs-params">i.KeyDown(OpenTK.Input.Key.D</span>) || i.<span class="hljs-title">KeyDown</span>(<span class="hljs-params">OpenTK.Input.Key.Right</span>)) </span>{
</code></pre>
<p>to this:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> (<span class="hljs-params">targetTile.X &gt; currentTile.X</span>) </span>{
</code></pre>
<p>Chang the up and down if statements on your own. We call this broad phase movement, because it gets the player to the correct tile, not the correct pixel. We will add narro phase movement soon.</p>
<h3 id="hook-it-up">Hook it up</h3>
<p>In <strong>Game.cs</strong>, set the players target tile if a tile is clicked. We only want to set this target if the tile being clicked is walkable:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (InputManager.Instance.MousePressed(OpenTK.Input.MouseButton.Left)) {
    <span class="hljs-keyword">if</span> (currentMap[cursorTile.Y][cursorTile.X].Walkable) {
        hero.SetTargetTile(cursorTile);
    }
}
</code></pre>
<p><strong>Run the game</strong>, clicking around the map should cause the hero to walk to the selected tile! There are two problems. First, when you are behind a blocking tile and you click straight ahead the player will just forever walk into the obstacle. This is just dumb ai. We are not going to fix that in this lesson.</p>
<p>The second, and perhaps more glaring issue is that the player is ok walking right or down. However walking left or up the player stops just one tile short of the target. This is because our registration point is in the top left of the character and the top left pixel is in the target tile already.</p>
<h3 id="narrow-phase-movement">Narrow phase movement</h3>
<p>The only way to solve our hero stopping one tile short is to add more fine grained collision controls. The <code>if</code> / <code>else if</code> for x movement, we&apos;re going to add another <code>else if</code> to that. </p>
<p>This new else if checks how far the player is from the target x / y position (pixel, not tile). If he is close enough, he will be snapped to the pixel, if not he will just continue moving towards it.</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> (<span class="hljs-params">Position.X != currentTile.X</span>) </span>{
    <span class="hljs-comment">// More than two pixels away, walk</span>
    <span class="hljs-keyword">if</span> (Math.Abs(Position.X - currentTile.X * Game.TILE_SIZE) &gt; <span class="hljs-number">2</span>) {
        SetSprite(<span class="hljs-string">&quot;Left&quot;</span>);
        Animate(deltaTime);
        Position.X -= speed * deltaTime;
    }
    <span class="hljs-comment">// Two pixels away, snap!</span>
    <span class="hljs-keyword">else</span> {
        Position.X = currentTile.X * Game.TILE_SIZE;
    }
}
</code></pre>
<p>Dont forget to do the same thing for the y axis! <strong>Run the game</strong>, clicking around, link should always walk to the right tile. Evenif he takes a dumb route.</p>
<h3 id="doors">Doors</h3>
<p>Now clicking aroudn moves us correctly, but what happens if you walk into a door? You try to walk to the door tile on the next map! This needs to get fixed.</p>
<p>Find the code that makes the hero walk trough a door and shows the new room. In that code, set the heros target tile to be right outside the door (the specified target position). That should cuase the player to just switch rooms.</p>
<p>I purposley left the instructions for that last part very vague. I want you to think about this, look at your code and try to solve the problem yourself. If you need any help or guidance i&apos;m aways here.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Iso_MakeItems.html" class="navigation navigation-prev " aria-label="Previous page: Items & Projectiles">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Chapter7.html" class="navigation navigation-next " aria-label="Next page: More Tiles">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Mouse To Move","level":"1.19","depth":1,"next":{"title":"More Tiles","level":"1.20","depth":1,"path":"Chapter7.md","ref":"Chapter7.md","articles":[]},"previous":{"title":"Items & Projectiles","level":"1.18.3","depth":2,"path":"Iso_MakeItems.md","ref":"Iso_MakeItems.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"letter","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Chapter24.md","mtime":"2016-07-09T03:24:55.790Z","type":"markdown"},"gitbook":{"version":"3.1.1","time":"2016-10-03T18:07:37.300Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

