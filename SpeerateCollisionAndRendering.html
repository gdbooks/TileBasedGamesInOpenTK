
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Collision & Rendering Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.1">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="AddingAHouse.html" />
    
    
    <link rel="prev" href="Chapter22.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Chapter1.html">
            
                <a href="Chapter1.html">
            
                    
                    Starting Out
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="FrameworksSources.html">
            
                <a href="FrameworksSources.html">
            
                    
                    Managers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="Game.html">
            
                <a href="Game.html">
            
                    
                    Game
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="Program.html">
            
                <a href="Program.html">
            
                    
                    Program
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Chapter2.html">
            
                <a href="Chapter2.html">
            
                    
                    Why Tiles?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Chapter3.html">
            
                <a href="Chapter3.html">
            
                    
                    Map Format
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Chapter6.html">
            
                <a href="Chapter6.html">
            
                    
                    Creating Tiles
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="Practice/PracticeCh6.html">
            
                <a href="Practice/PracticeCh6.html">
            
                    
                    On Your Own
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Chapter5.html">
            
                <a href="Chapter5.html">
            
                    
                    Map Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="Chapter8.html">
            
                <a href="Chapter8.html">
            
                    
                    The Hero
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="Practice/PracticeTheHero.html">
            
                <a href="Practice/PracticeTheHero.html">
            
                    
                    On Your Own
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="Chapter9.html">
            
                <a href="Chapter9.html">
            
                    
                    Keys To Move
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="Practice/PracticeMoving.html">
            
                <a href="Practice/PracticeMoving.html">
            
                    
                    On Your Own
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="Chapter10.html">
            
                <a href="Chapter10.html">
            
                    
                    Hit The Wall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="Chapter11.html">
            
                <a href="Chapter11.html">
            
                    
                    Open The Door
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="cleanup.html">
            
                <a href="cleanup.html">
            
                    
                    Cleaning Up
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="borders.html">
            
                <a href="borders.html">
            
                    
                    Screen Borders
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="Chapter12.html">
            
                <a href="Chapter12.html">
            
                    
                    Jumping
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="jumpconfig.html">
            
                <a href="jumpconfig.html">
            
                    
                    Configurable Jumping
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="Chapter13.html">
            
                <a href="Chapter13.html">
            
                    
                    Clouds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="Chapter15.html">
            
                <a href="Chapter15.html">
            
                    
                    Simple Enemy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="Chapter17.html">
            
                <a href="Chapter17.html">
            
                    
                    Shooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="Chapter18.html">
            
                <a href="Chapter18.html">
            
                    
                    Getting Items
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="Chapter20.html">
            
                <a href="Chapter20.html">
            
                    
                    Scrolling
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="Chapter21.html">
            
                <a href="Chapter21.html">
            
                    
                    Limit Scrolling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="Chapter22.html">
            
                <a href="Chapter22.html">
            
                    
                    Depth
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.17.1" data-path="SpeerateCollisionAndRendering.html">
            
                <a href="SpeerateCollisionAndRendering.html">
            
                    
                    Collision & Rendering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="AddingAHouse.html">
            
                <a href="AddingAHouse.html">
            
                    
                    Visual Tweaks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="DepthBuffer.html">
            
                <a href="DepthBuffer.html">
            
                    
                    Depth Buffer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="Chapter23.html">
            
                <a href="Chapter23.html">
            
                    
                    Ismetric View
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="Iso_MakeMap.html">
            
                <a href="Iso_MakeMap.html">
            
                    
                    Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="Iso_MakeCharacters.html">
            
                <a href="Iso_MakeCharacters.html">
            
                    
                    Characters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3" data-path="Iso_MakeItems.html">
            
                <a href="Iso_MakeItems.html">
            
                    
                    Items & Projectiles
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="Chapter24.html">
            
                <a href="Chapter24.html">
            
                    
                    Mouse To Move
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="Chapter7.html">
            
                <a href="Chapter7.html">
            
                    
                    More Tiles
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Collision & Rendering</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="seperating-collision--rendering">Seperating Collision &amp; Rendering</h1>
<p>The first thing we need to do in order to add depth to our game is to seperate the collision rectangle of characters and tiles from their rendering. This will give us the unsorted illusion of depth. By the end of this chapter we want to achieve this effect (Note how links head is above the tile):</p>
<p><img src="Images/depth_effect.PNG" alt="DEPTH"></p>
<h3 id="new-project">New Project</h3>
<p>Let&apos;s make a new project, call it <strong>DepthBase</strong> and get this project up to par with the <strong>LimitedScrolling</strong> section of the writeup. We&apos;re going to work from here.</p>
<h2 id="character">Character</h2>
<p>We&apos;re going to start by changing the scrolling behaviour of the character class. Starting with the character is nice, we get the effects of it applied to both the player character and enemy character! We&apos;re only going to add depth on the Y axis for now, it&apos;s rare to see depth on the X axis.</p>
<p>We are going to hard code the height of the character to some constant number (In this example 20px). Whenever the corners or bounding rectangle of the character is requested we&apos;re going to change the return to have 20 hard coded to it. Then we&apos;re going to change the render function, we&apos;re going to change it to render the sprite at Position.Y - 20 instead of Position.Y.</p>
<p>These changes will cause a 20px gap at the top of our characters. This part of the sprite will still be drawn, but it won&apos;t be taken into collision calculations. I made a graphic atempting to describe what we will be doing:</p>
<p><img src="Images/depth_explained.png" alt="DEPTH_EXPLAINED"></p>
<h3 id="debug-rendering">Debug Rendering</h3>
<p>Before we start coding anything, let&apos;s make our lives easyer by adding a little debug indicator to the <code>Character</code> class. At the end of the <strong>Render</strong> function, add this bit of code:</p>
<pre><code>// Get a 3x3 rectangle, centered on the top left pixel
Rectangle positionLocator = new Rectangle((int)Position.X - 1, (int)Position.Y - 1, 3, 3);
// Apply camera offset
positionLocator.X -= (int)offsetPosition.X;
positionLocator.Y -= (int)offsetPosition.Y;
// Draw indicator
GraphicsManager.Instance.DrawRect(positionLocator, Color.Yellow);
</code></pre><p>This should draw a 3x3 yellow rectangle centered at the top left pixel of the character. If you run your game you should see this:</p>
<p><img src="Images/topleft_pixel.png" alt="TOP_LEFT"></p>
<h3 id="applying-depth">Applying Depth</h3>
<p>First, we have to add a new member variable to the <code>Character</code> class. Make it a protected <strong>float</strong> and call it <code>Height</code>. Set it to <strong>-1</strong> by default. If the new variable is less than 0 we will not apply the depth effect to the character, if it is greater than 0 we will apply a depth effect.</p>
<p>Next, change the constructor of character, it should now take in a third argument, a float called height. Set the member variable accordingly. Since we changed the constructor, we need to change where the constructor gets called. Find the following code in both <code>PlayerCharacter</code> and <code>EnemyCharacter</code>:</p>
<pre><code class="lang-cs">: <span class="hljs-keyword">base</span>(spritePath, pos) {
</code></pre>
<p>In <code>PlayerCharacter</code> pass <strong>20</strong> as the third argument, in <code>EnemyCharacter</code> pass <strong>-1</strong> as the third argument. By using constants as the last argument of the base constructor we can avoid changing the constructor of <code>PlayerCharacter</code> and <code>EnemyCharacter</code>. Needless to say, the player will have a depth effect, while the enemy will not.</p>
<p>Change the <strong>Rect</strong> getter in the <code>Character</code> class. If the new <code>Height</code> variable is &gt;= 0, set the returned rectangles height to the varaible.</p>
<p>Change the <strong>Corners</strong> getter. Right now it uses this bit of code to add height to corners <code>SpriteSources[currentSprite][currentFrame].Height</code>, if the new <code>Height</code> variable is &gt;= 0, use the <code>Height</code> variable, if it&apos;s less than 0 keep using what was already there.</p>
<p>Finally, change the <strong>Render</strong> function. After subtracting <code>offsetPosition</code> from <code>renderPosition</code>, if the new <code>Height</code> variable is &gt;= 0 find the height difference of the frame height and the hard coded height:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">int</span> difference = SpriteSources[currentSprite][currentFrame].Height - (<span class="hljs-keyword">int</span>)Height;
</code></pre>
<p>and subtract it from from <code>renderPosition.Y</code>. That should do it. <strong>Run the game</strong> and you should be able to walk up to walls and overlap them a bit. Links head should be above the yellow debug indicator. our game should look like this:</p>
<p><img src="Images/done_height.PNG" alt="DONE_HEIGHT"></p>
<p>Notice how the moblins yellow indicator pixel is at his top left, while link&apos;s is slightly below his head. Also, links head slightly overlaps the obstacle. This is what we expected.</p>
<h2 id="tiles">Tiles</h2>
<p>The character having depth is awesome, but we&apos;re going to want the tiles to have depth too! Unlike character however we always know the height of a tile, it&apos;s 30! Because we already know the height of the tile, all we need to change is the <code>Render</code> function in <strong>Tile.cs</strong>.</p>
<p>This is what the current tile render function looks like (I&apos;ve added comments to help readability):</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params">PointF offsetPosition</span>) </span>{
    <span class="hljs-comment">// Find the world render position of this tile</span>
    Point renderPos = <span class="hljs-keyword">new</span> Point(WorldPosition.X, WorldPosition.Y);
    <span class="hljs-comment">// Apply scale to tile offset</span>
    renderPos.X = (<span class="hljs-keyword">int</span>)(Scale * renderPos.X);
    renderPos.Y = (<span class="hljs-keyword">int</span>)(Scale * renderPos.Y);
    <span class="hljs-comment">// Move the tile into camera space</span>
    renderPos.X -= (<span class="hljs-keyword">int</span>)offsetPosition.X;
    renderPos.Y -= (<span class="hljs-keyword">int</span>)offsetPosition.Y;
    <span class="hljs-comment">// Draw the tile</span>
    TextureManager.Instance.Draw(Sprite, renderPos, Scale, Source);
}
</code></pre>
<p>After moving the tile into camera space, make a new rectangle, call it renderRect and copy Source into is, then use this new renderRect to draw instead of Source (Change last argument). You can copy one rect into another with only two arguments like so:</p>
<pre><code class="lang-cs">Rectangle renderRect = <span class="hljs-keyword">new</span> Rectangle(Source.Location, Source.Size);
</code></pre>
<p>After creating renderRect, check it&apos;s height. If renderRect.Height <strong>is not equal to</strong> 30 we will want to offset the tile render position. </p>
<p>To offset the render position, first find the <code>heightDifference</code> by subtracting 30 from renderRect.Height, i suggest storing this in a variable. Then, subtract <code>heightDifference</code> from <code>renderRect.Y</code>.</p>
<p>That&apos;s it! Tiles now have the same depth support that the character does. We will not be able to test this right now for two resons. First, we don&apos;t have any tiles that are taler than 30 pixels. </p>
<p>Second, because we draw all the tiles first, then the character on top, we would never see the character behind a tile. We&apos;re going to fix this in the next section.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Chapter22.html" class="navigation navigation-prev " aria-label="Previous page: Depth">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="AddingAHouse.html" class="navigation navigation-next " aria-label="Next page: Visual Tweaks">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Collision & Rendering","level":"1.17.1","depth":2,"next":{"title":"Visual Tweaks","level":"1.17.2","depth":2,"path":"AddingAHouse.md","ref":"AddingAHouse.md","articles":[]},"previous":{"title":"Depth","level":"1.17","depth":1,"path":"Chapter22.md","ref":"Chapter22.md","articles":[{"title":"Collision & Rendering","level":"1.17.1","depth":2,"path":"SpeerateCollisionAndRendering.md","ref":"SpeerateCollisionAndRendering.md","articles":[]},{"title":"Visual Tweaks","level":"1.17.2","depth":2,"path":"AddingAHouse.md","ref":"AddingAHouse.md","articles":[]},{"title":"Depth Buffer","level":"1.17.3","depth":2,"path":"DepthBuffer.md","ref":"DepthBuffer.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"letter","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"SpeerateCollisionAndRendering.md","mtime":"2016-07-09T03:24:55.924Z","type":"markdown"},"gitbook":{"version":"3.1.1","time":"2016-10-03T18:07:37.300Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

